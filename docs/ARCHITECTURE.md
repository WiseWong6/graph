# ç³»ç»Ÿæ¶æ„

## ç³»ç»Ÿæ¦‚è¿°

Write Agent æ˜¯ä¸€ä¸ªåŸºäº LangGraph.js çš„å¤šä»£ç†å†…å®¹ç”Ÿæˆç³»ç»Ÿï¼Œé‡‡ç”¨ç ”ç©¶ä¼˜å…ˆçš„å·¥ä½œæµã€‚

## æ ¸å¿ƒç»„ä»¶

### ä»£ç†èŠ‚ç‚¹ (`src/agents/article/nodes/`)

- **00_select_wechat** - äº¤äº’å¼é€‰æ‹©å…¬ä¼—å·è´¦å·
- **01_select_model** - äº¤äº’å¼é€‰æ‹© LLM æ¨¡å‹
- **02_research** - è°ƒç ”ä¸ Brief ç”Ÿæˆï¼ˆå¹¶è¡Œæœç´¢ + LLM åˆ†æï¼‰
- **03_rag** - åŸºäº RAG çš„å†…å®¹å¢å¼ºï¼ˆé‡‘å¥åº“ + æ–‡ç« åº“ï¼‰
- **04_titles** - æ ‡é¢˜ç”Ÿæˆï¼ˆåŸºäº Brief + RAGï¼‰
- **05_select_title** - äº¤äº’å¼æ ‡é¢˜é€‰æ‹©ï¼ˆæ”¯æŒè‡ªå®šä¹‰ + é‡æ–°ç”Ÿæˆï¼‰
- **06_draft** - åˆç¨¿ç”Ÿæˆï¼ˆRAG å¢å¼ºï¼‰
- **07_rewrite** - æ™ºæ€§å™äº‹é‡å†™ï¼ˆIPS åŸåˆ™ + HKR è‡ªæ£€ï¼‰
- **08_confirm** - äº¤äº’å¼å›¾ç‰‡é…ç½®ç¡®è®¤
- **09_humanize** - å»æœºæ¢°åŒ–å¤„ç†ï¼ˆCode First, AI Secondï¼‰
- **10_prompts** - å›¾ç‰‡æç¤ºè¯ç”Ÿæˆï¼ˆ5 ç§é£æ ¼ï¼‰
- **11_images** - å›¾ç‰‡ç”Ÿæˆï¼ˆArk APIï¼Œå¹¶è¡Œç”Ÿæˆï¼‰
- **12_upload** - å›¾ç‰‡ä¸Šä¼ åˆ°å¾®ä¿¡ CDNï¼ˆå›é€€æœºåˆ¶ï¼‰
- **13_wait_for_upload** - å¹¶è¡ŒåŒæ­¥ç‚¹
- **14_html** - HTML è½¬æ¢ï¼ˆmarkdown-it è§£æï¼‰
- **15_draftbox** - å‘å¸ƒåˆ°è‰ç¨¿ç®±ï¼ˆstable tokenï¼‰

**å¹¶è¡Œæ‰§è¡Œè®¾è®¡ï¼š**

**ç¬¬ä¸€å±‚å¹¶è¡Œï¼ˆResearch åï¼‰ï¼š**
```
02_research â”€â”¬â”€â†’ 03_rag (RAG æ£€ç´¢)
             â””â”€â†’ 04_titles (æ ‡é¢˜ç”Ÿæˆ)
             â””â”€â†’ 05_select_title (ç­‰å¾…ä¸¤è€…å®Œæˆ)
```

**ç¬¬äºŒå±‚å¹¶è¡Œï¼ˆConfirm åï¼‰ï¼š**
```
08_confirm â”€â”¬â”€â†’ 09_humanize (æ–‡æœ¬å¤„ç†)
            â””â”€â†’ 10_prompts â†’ 11_images â†’ 12_upload â†’ 13_wait_for_upload (å›¾ç‰‡æµç¨‹)
            â””â”€â†’ 14_html (æ±‡èšç‚¹ï¼Œç­‰å¾…ä¸¤è€…å®Œæˆ)
```

### é€‚é…å™¨ (`src/adapters/`)

**æœç´¢åŸºç¡€è®¾æ–½ï¼š**
- **ParallelSearchManager** - å¤šæºæœç´¢ï¼ŒåŸºäºä¼˜å…ˆçº§çš„é™çº§æœºåˆ¶
  - WebResearch (Google via Playwright) - ä¼˜å…ˆçº§ 1
  - Firecrawl - ä¼˜å…ˆçº§ 2
- **Firecrawl** - ç½‘é¡µæŠ“å–å’Œæœç´¢ API
- **WebResearch** - é€šè¿‡ Playwright è¿›è¡Œ Google æœç´¢

**å·²ç§»é™¤ï¼š**
- ~~DuckDuckGo~~ï¼ˆAPI ä¸å¯é ï¼Œé¢‘ç¹è¶…æ—¶ï¼‰

### CLI (`src/cli/`)

- **step-cli.ts** - æ­¥è¿›å¼ CLIï¼ˆä¸»äº¤äº’ç•Œé¢ï¼‰
  - æµå¼è¾“å‡ºç¼“å†²ï¼ˆèšç„¦èŠ‚ç‚¹ä¼˜å…ˆï¼‰
  - å¹¶è¡Œæ‰§è¡Œè¿½è¸ª
  - èŠ‚ç‚¹é”™è¯¯å¤„ç†ï¼ˆé‡è¯•/è·³è¿‡/é‡æ–°è¿è¡Œï¼‰
  - Resume é›†æˆ
- **resume-manager.ts** - æ¢å¤ç®¡ç†å™¨
  - åˆ—å‡ºå†å² threadï¼ˆçŠ¶æ€å›¾æ ‡ + æ—¶é—´æ˜¾ç¤ºï¼‰
  - åˆ—å‡º checkpointï¼ˆèŠ‚ç‚¹åç§° + ä¸‹ä¸€æ­¥æç¤ºï¼‰
  - ä»ä»»æ„ checkpoint æ¢å¤
- **research-cli.ts** - äº¤äº’å¼ç ”ç©¶ä»£ç† CLI
- **index.ts** - ä¸» CLI å…¥å£

### å·¥å…·å‡½æ•° (`src/utils/`)

- **text-cleaner.ts** - ç¡®å®šæ€§æ ¼å¼åŒ–æ¸…æ´—
  - `processMarkdown` - Markdown ç»“æ„ä¿æŠ¤ï¼ˆä»£ç /é“¾æ¥/å›¾ç‰‡ï¼‰
  - `cleanTextFormatting` - æ ¼å¼æ¸…æ´—è§„åˆ™ï¼ˆç ´æŠ˜å·ã€å¼•å·ã€ç©ºæ ¼ï¼‰
  - `humanizeFormat` - å¯¹å¤–å…¥å£
- **llm-client.ts** - LLM ç»Ÿä¸€æ¥å£
- **llm-runner.ts** - LLM è°ƒç”¨å°è£…ï¼ˆå¸¦é‡è¯•æœºåˆ¶ï¼‰
- **llm-output.ts** - æµå¼è¾“å‡ºåè°ƒå™¨
- **metrics.ts** - æ€§èƒ½æŒ‡æ ‡è¿½è¸ª
  - èŠ‚ç‚¹æ‰§è¡Œæ—¶é—´
  - LLM Token ä½¿ç”¨é‡
  - å†…å­˜ä½¿ç”¨ç›‘æ§
  - é”™è¯¯ç»Ÿè®¡
- **brief-generator.ts** - Brief æ¨¡æ¿ç”Ÿæˆ
- **research-scorer.ts** - ç½®ä¿¡åº¦è®¡ç®—ã€æ—¶æ•ˆæ€§æ£€æµ‹
- **handoff-builder.ts** - YAML handoff æ ¼å¼ç”Ÿæˆ

### é…ç½® (`src/config/`)

- **llm.ts** - å¤šæä¾›å•†æ”¯æŒï¼ŒèŠ‚ç‚¹çº§è®¾ç½®
  - DeepSeek - æ€è€ƒæ¨¡å‹
  - Anthropic - é«˜è´¨é‡ç”Ÿæˆ
  - Volcengine - ç«å±±å¼•æ“ï¼Œæ”¯æŒæ·±åº¦æ€è€ƒ
  - èŠ‚ç‚¹çº§æ¨¡å‹åˆ‡æ¢ï¼ˆæ”¯æŒå…¨å±€å’ŒèŠ‚ç‚¹çº§è¦†ç›–ï¼‰

## æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ (CLI)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µ 1ï¼šé¡ºåºå‰ç½®æµç¨‹                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ START â†’ 00_select_wechat â†’ 01_select_model â†’ 02_research      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¶æ®µ 2ï¼šç¬¬ä¸€å±‚å¹¶è¡Œ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  02_research å®Œæˆï¼Œæ‹†åˆ†ä¸ºä¸¤ä¸ªåˆ†æ”¯ï¼š              â”‚
â”‚                                                                  â”‚
â”‚  åˆ†æ”¯ 1 (RAG)ï¼š                                                â”‚
â”‚    02_research â†’ 03_rag â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                                                  â”‚              â”‚
â”‚  åˆ†æ”¯ 2 (æ ‡é¢˜)ï¼š                              â”‚
â”‚    02_research â†’ 04_titles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚                                                  â”œâ”€â†’ 05_select_title
â”‚  LangGraph ç­‰å¾…ä¸¤è€…éƒ½å®Œæˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é˜¶æ®µ 3ï¼šé¡ºåºä¸­é—´æµç¨‹                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 05_select_title â†’ 06_draft â†’ 07_rewrite â†’ 08_confirm          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             é˜¶æ®µ 4ï¼šç¬¬äºŒå±‚å¹¶è¡Œ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  08_confirm å®Œæˆï¼Œæ‹†åˆ†ä¸ºä¸¤ä¸ªåˆ†æ”¯ï¼š                â”‚
â”‚                                                                  â”‚
â”‚  åˆ†æ”¯ 1 (å›¾ç‰‡æµç¨‹)ï¼š                                     â”‚
â”‚    08_confirm â†’ 10_prompts â†’ 11_images â†’ 12_upload â†’ 13_wait   â”‚
â”‚                            â”‚                                     â”‚
â”‚  åˆ†æ”¯ 2 (æ–‡æœ¬å¤„ç†)ï¼š                                    â”‚
â”‚    08_confirm â†’ 09_humanize â†â”€â”˜ (ä½¿ç”¨ confirm ä¸­çš„ imageCount)  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ±‡èšé˜¶æ®µ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  09_humanize + 13_wait â”€â”€â†’ 14_html â†’ 15_draftbox â†’ END        â”‚
â”‚                                                                  â”‚
â”‚  (html èŠ‚ç‚¹å°†å›¾ç‰‡å ä½ç¬¦æ›¿æ¢ä¸º CDN URL)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è¾“å‡ºç›®å½•
```

**å…³é”®ä¼˜åŒ–ç‚¹ï¼š**

**ç¬¬ä¸€å±‚å¹¶è¡Œï¼ˆResearch â†’ RAG/Titlesï¼‰ï¼š**
- `03_rag` å’Œ `04_titles` åœ¨ `02_research` å®ŒæˆååŒæ—¶å¯åŠ¨
- ä¸¤ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥åŠ è½½ IndexManager ç´¢å¼•ï¼ˆé€šè¿‡å¹‚ç­‰æ€§ä¿æŠ¤ï¼‰
- LangGraph è‡ªåŠ¨ç­‰å¾…ä¸¤è€…éƒ½å®Œæˆåæ‰ç»§ç»­åˆ° `05_select_title`
- **èŠ‚çœæ—¶é—´**ï¼šmin(T03, T04)

**ç¬¬äºŒå±‚å¹¶è¡Œï¼ˆConfirm â†’ Image/Textï¼‰ï¼š**
- `10_prompts` ä½¿ç”¨ `draft` ä½œä¸ºè¾“å…¥ï¼ˆä¸æ˜¯ `humanized`ï¼‰â†’ å¯ä»¥ä¸ `09_humanize` å¹¶è¡Œè¿è¡Œ
- `09_humanize` æ ¹æ® `state.decisions.images.count` æ’å…¥å›¾ç‰‡å ä½ç¬¦
- `13_wait_for_upload` ç¡®ä¿ä¸Šä¼ å®Œæˆåæ‰è§¦å‘ HTML è½¬æ¢
- `14_html` å°†å ä½ç¬¦æ›¿æ¢ä¸º `12_upload` çš„å®é™… CDN URL
- **èŠ‚çœæ—¶é—´**ï¼šT09ï¼ˆhumanize è¿è¡Œæ—¶å›¾ç‰‡æµç¨‹åœ¨å¤„ç†ï¼‰

## è°ƒç ” Brief ç»“æ„

```markdown
# å†…å®¹è°ƒç ”æŠ¥å‘Šï¼š{ä¸»é¢˜}

## è°ƒç ”æ¦‚è¿°
- ä¸»é¢˜ã€æ—¶é—´ã€æ—¶æ•ˆæ€§çª—å£ã€è°ƒç ”æ·±åº¦

## æ ¸å¿ƒæ´å¯Ÿ
- 4-5 ä¸ªæ·±åº¦æ´å¯Ÿ

## å…³é”®æ¦‚å¿µæ¡†æ¶
- 4å±‚åˆ†ææ¡†æ¶

## æ•°æ®å¼•ç”¨æ¸…å•
- å…·ä½“æ•°æ®æŒ‡æ ‡

## å·®å¼‚åŒ–è§’åº¦å»ºè®®
- 3 ä¸ªå†™ä½œè§’åº¦ï¼ˆå«å¯è¡Œæ€§è¯„åˆ†ï¼‰

## æ¨èå†™ä½œè§’åº¦
- æœ€ä¼˜è§’åº¦ + è¯¦ç»†ç†ç”±

## å‚è€ƒèµ„æ–™
- æ‰€æœ‰å¼•ç”¨æ¥æº
```

## RAG å†…å®¹ç»“æ„

```markdown
# RAG æ£€ç´¢ç»“æœ

**ä¸»é¢˜**: {ä¸»é¢˜}
**æ£€ç´¢æ—¶é—´**: {ms}

## ç›¸å…³é‡‘å¥ ({count})
1. "{é‡‘å¥å†…å®¹}"
   > æ¥æº: {æ–‡ç« æ ‡é¢˜} | {ä½œè€…}

## ç›¸å…³æ–‡ç« ç‰‡æ®µ ({count})
### 1. {æ–‡ç« æ ‡é¢˜}
{å†…å®¹ç‰‡æ®µ...}
   > æ¥æº: {ä½œè€…}

## å‚è€ƒæ ‡é¢˜ ({count})
1. {æ ‡é¢˜}
2. {æ ‡é¢˜}
...
```

## çŸ¥è¯†åº“

```
data/
â”œâ”€â”€ golden_sentences.jsonl    # 37,420 é‡‘å¥ (50.9 MB)
â”œâ”€â”€ article_titles.jsonl        # 6,975 æ ‡é¢˜ (763 KB)
â””â”€â”€ articles/
    â”œâ”€â”€ åˆ˜æ¶¦.jsonl              # 3,072 ç¯‡æ–‡ç« 
    â”œâ”€â”€ ç²¥å·¦ç½—(1).jsonl         # 3,327 ç¯‡æ–‡ç« 
    â””â”€â”€ æ•°å­—ç”Ÿå‘½å¡å…¹å…‹.jsonl      #   576 ç¯‡æ–‡ç« 
```

**æ€»è®¡**ï¼š51,370 æ¡å¯æœç´¢æ¡ç›®

## Humanize æ¶æ„ï¼ˆCode First, AI Secondï¼‰

### è®¾è®¡å“²å­¦
**"Code å¤„ç†æ­»æ¿è§„åˆ™ï¼ŒLLM æ³¨å…¥çµé­‚"**

- **Phase A (Code)**: ä½¿ç”¨ç¡®å®šæ€§æ­£åˆ™æ¸…æ´—
  - ç ´æŠ˜å·æ›¿æ¢ï¼ˆ`--` / `â€”â€”` â†’ `ï¼Œ`ï¼‰
  - æ ‡ç‚¹ä¸­æ–‡åŒ–ï¼ˆä¸­æ–‡å‰åçš„è‹±æ–‡æ ‡ç‚¹ï¼‰
  - å»å¤šä½™ç©ºæ ¼ï¼ˆä¸­æ–‡-è‹±æ–‡ã€æ•°å­—-å•ä½ï¼‰
  - å»å¼•å·ï¼ˆé’ˆå¯¹å¼ºè°ƒæ€§çŸ­è¯­ï¼‰
  - å»ç©ºè¡Œï¼ˆæ®µè½é—´åªç•™ä¸€ä¸ªç©ºè¡Œï¼‰
  - Markdown ç»“æ„ä¿æŠ¤ï¼ˆä»£ç /é“¾æ¥/å›¾ç‰‡ï¼‰

- **Phase B (LLM)**: ä¸“æ³¨äºå» AI å‘³å’Œæ¶¦è‰²
  - æ¶ˆé™¤ç¿»è¯‘è…”ã€ä¸»æŒäººè…”
  - å»é™¤ä¼ªäº’åŠ¨ä¸å¼ºè¡Œæ‚¬å¿µ
  - æ®µè½èåˆä¸å£è¯­åŒ–
  - ä¿ç•™ Markdown æ ‡è®°

### ä¼˜åŠ¿
- æ¶ˆé™¤ LLM å¤„ç†å¼•å·/ç ´æŠ˜å·æ—¶çš„å¹»è§‰é£é™©
- æ ¼å¼ä¸€è‡´æ€§ä¿è¯
- LLM èµ„æºç”¨äºæ›´æœ‰ä»·å€¼çš„é£æ ¼ä¼˜åŒ–

## ResumeManager åŠŸèƒ½

### æ ¸å¿ƒèƒ½åŠ›
1. **åˆ—å‡ºæ‰€æœ‰å†å² thread**
   - çŠ¶æ€å›¾æ ‡ï¼ˆâœ…/â¸ï¸/âŒï¼‰
   - å‹å¥½æ—¶é—´æ˜¾ç¤ºï¼ˆä»Šæ™š/æ˜¨å¤©/å‰å¤©/æ—¥æœŸï¼‰
   - èŠ‚ç‚¹åç§°ï¼ˆä¸­æ–‡å‹å¥½ï¼‰
   - å·²è€—æ—¶ç»Ÿè®¡

2. **åˆ—å‡ºæŸä¸ª thread çš„æ‰€æœ‰ checkpoint**
   - ç²¾ç¡®æ—¶é—´æˆ³ï¼ˆæ¥è‡ª checkpoint `ts`ï¼‰
   - èŠ‚ç‚¹åç§°æ˜ å°„
   - ä¸‹ä¸€æ­¥èŠ‚ç‚¹æç¤º
   - èŠ‚ç‚¹æ‘˜è¦ä¿¡æ¯

3. **ä» checkpoint æ¢å¤æ‰§è¡Œ**
   - é›¶ç ´åæ€§ï¼ˆä¸ä¿®æ”¹å›¾ç»“æ„ï¼‰
   - æ”¯æŒä»»æ„ checkpoint æ¢å¤

### ä½¿ç”¨åœºæ™¯
- **å¤±è´¥é‡è¯•**ï¼šèŠ‚ç‚¹æ‰§è¡Œå¤±è´¥åä¿®å¤é‡è¯•
- **å›é€€å®éªŒ**ï¼šå›åˆ°ä¹‹å‰èŠ‚ç‚¹å°è¯•ä¸åŒå‚æ•°
- **æ–­ç‚¹ç»­è·‘**ï¼šä»ä¸­æ–­å¤„ç»§ç»­æ‰§è¡Œ

## Upload èŠ‚ç‚¹å›é€€æœºåˆ¶

### é—®é¢˜åœºæ™¯
ä½¿ç”¨ `--resume` æ¢å¤ä¼šè¯æ—¶ï¼Œ`state.decisions.wechat` é…ç½®å¯èƒ½ä¸¢å¤±ã€‚

### è§£å†³æ–¹æ¡ˆ
1. è‡ªåŠ¨æ£€æµ‹é…ç½®ç¼ºå¤±
2. äº¤äº’å¼æç¤ºç”¨æˆ·é€‰æ‹©å…¬ä¼—å·
3. è‡ªåŠ¨ä¿å­˜é€‰æ‹©çš„é…ç½®åˆ° state
4. ä¸‹æ¬¡æ¢å¤ä¸ä¼šä¸¢å¤±

### å®ç°
```typescript
if (!wechatConfig) {
  wechatConfig = await promptForWechat();
  // ä¿å­˜åˆ° state
  result.decisions = {
    ...state.decisions,
    wechat: wechatConfig
  };
}
```

## Step CLI è¾“å‡ºä¼˜åŒ–

### æµå¼è¾“å‡ºç¼“å†²
**ç›®çš„ï¼šé¿å…å¹¶è¡Œæ‰§è¡Œæ—¶çš„è¾“å‡ºæ··ä¹±**

**èšç„¦èŠ‚ç‚¹æœºåˆ¶ï¼š**
- Research åå¹¶è¡Œï¼šèšç„¦ `04_titles`ï¼Œç¼“å†² `02_rag`
- Confirm åå¹¶è¡Œï¼šèšç„¦ `09_humanize`ï¼Œç¼“å†² `10_prompts/11_images/12_upload`

**å®ç°ï¼š**
```typescript
const getStreamFocusNode = (currentNode: string): string | null => {
  if (currentNode === "04_titles" || currentNode === "03_rag") {
    return "04_titles";
  }
  if (currentNode === "09_humanize" || 
      currentNode === "10_prompts" ||
      currentNode === "11_images" ||
      currentNode === "12_upload" ||
      currentNode === "13_wait_for_upload") {
    return "09_humanize";
  }
  return null;
};
```

### è€—æ—¶é¢æ¿ç²¾ç®€
- **ä¿ç•™**ï¼šæ€»è€—æ—¶
- **ç§»é™¤**ï¼šèŠ‚ç‚¹/compute ç»Ÿè®¡ï¼ˆå‡å°‘å™ªéŸ³ï¼‰

## æ€§èƒ½æŒ‡æ ‡è¿½è¸ª

### MetricsTracker (`src/utils/metrics.ts`)

**æŒ‡æ ‡ç±»å‹ï¼š**
- Counter - è®¡æ•°å™¨ï¼ˆé€’å¢ï¼‰
- Gauge - ä»ªè¡¨ï¼ˆå½“å‰å€¼ï¼‰
- Histogram - ç›´æ–¹å›¾ï¼ˆåˆ†å¸ƒï¼‰

**è¿½è¸ªå†…å®¹ï¼š**
1. èŠ‚ç‚¹æ‰§è¡Œç»Ÿè®¡
   - æ‰§è¡Œæ—¶é—´
   - æˆåŠŸ/å¤±è´¥çŠ¶æ€
   - LLM Token ä½¿ç”¨é‡

2. LLM ä½¿ç”¨ç»Ÿè®¡
   - Prompt Tokens
   - Completion Tokens
   - Total Tokens
   - ä¼°ç®—æˆæœ¬

3. ç³»ç»Ÿèµ„æº
   - å†…å­˜ä½¿ç”¨ï¼ˆheap/heap total/rssï¼‰
   - èŠ‚ç‚¹é”™è¯¯ç»Ÿè®¡

**ä½¿ç”¨æ–¹å¼ï¼š**
```typescript
// èŠ‚ç‚¹æ‰§è¡Œ
const startTime = metrics.startNodeExecution("02_research");
try {
  const result = await callLLM(...);
  metrics.endNodeExecution("02_research", startTime, true, undefined, {
    promptTokens: result.promptTokens,
    completionTokens: result.completionTokens,
    totalTokens: result.totalTokens
  });
} catch (error) {
  metrics.endNodeExecution("02_research", startTime, false, String(error));
}
```

## è®¾è®¡åŸåˆ™

1. **ç ”ç©¶ä¼˜å…ˆ**ï¼šå†…å®¹ç”Ÿæˆå‰è¿›è¡Œæ·±åº¦è°ƒç ”
2. **å†…å®¹åˆ›ä½œå¯¼å‘**ï¼šBrief æœåŠ¡äºåˆ›ä½œè€…ï¼Œè€Œä¸ä»…ä»…æ˜¯åˆ—å‡ºå‘ç°
3. **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript è¦†ç›–
4. **å¯é…ç½®æ€§**ï¼šåŸºäº YAML çš„èŠ‚ç‚¹çº§ LLM é…ç½®
5. **æœç´¢å¼¹æ€§**ï¼šå¤šæºæœç´¢ï¼Œè‡ªåŠ¨é™çº§
6. **Code First, AI Second**ï¼šç¡®å®šæ€§è§„åˆ™ç”¨ä»£ç å¤„ç†ï¼Œé£æ ¼ä¼˜åŒ–ç”¨ LLM

## å½“å‰çŠ¶æ€

âœ… **å·²å®Œæˆï¼š**
- å¸¦å¹¶è¡Œæœç´¢çš„ç ”ç©¶èŠ‚ç‚¹
- åŸºäº LLM çš„æ´å¯Ÿæå–
- äº¤äº’å¼ CLIï¼ˆ`npm run step`ï¼‰
- å¤šè§’åº¦åˆ†æä¸æ¨è
- é«˜è´¨é‡ Brief ç”Ÿæˆ
- RAG èŠ‚ç‚¹å®ç°ï¼ˆä»£ç å®Œæˆï¼‰
- å¸¦ Brief/RAG è§£æçš„ Draft èŠ‚ç‚¹
- æ™ºæ€§å™äº‹é‡å†™èŠ‚ç‚¹
- **Humanize é‡æ„ï¼ˆCode First, AI Secondï¼‰**
- **Upload å›é€€æœºåˆ¶**
- **ResumeManager å¢å¼ºï¼ˆæ—¶é—´æ˜¾ç¤º + èŠ‚ç‚¹åç§°ï¼‰**
- **Step CLI ä¼˜åŒ–ï¼ˆæµå¼ç¼“å†² + è€—æ—¶ç²¾ç®€ï¼‰**
- **MetricsTracker å®Œæ•´å®ç°**
- **å®Œæ•´çš„ 16 èŠ‚ç‚¹å·¥ä½œæµï¼ŒåŒé‡å¹¶è¡Œä¼˜åŒ–**
  - ç¬¬ä¸€å±‚å¹¶è¡Œï¼šResearch åçš„ RAG + Titles
  - ç¬¬äºŒå±‚å¹¶è¡Œï¼šConfirm åçš„ prompts + humanize
- **IndexManager å¹‚ç­‰æ€§ä¿æŠ¤**
- **LanceDB å‘é‡å­˜å‚¨ TypeScript ä¿®å¤**
- **å‘é‡ç´¢å¼•æ„å»ºå®Œæˆ**

ğŸ“‹ **è®¡åˆ’ä¸­ï¼š**
- å·¥ä½œæµç«¯åˆ°ç«¯æµ‹è¯•
- åŸºäºå®é™…ä½¿ç”¨çš„ Prompt ä¼˜åŒ–
- é”™è¯¯å¤„ç†å¢å¼º
- æ›´å¤šé£æ ¼çš„å›¾ç‰‡æç¤ºè¯æ¨¡æ¿
