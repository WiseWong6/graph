# Article Agent Workflow Graph

## åŒé‡å¹¶è¡Œä¼˜åŒ–ç‰ˆæµç¨‹å›¾

```mermaid
graph TD
    START([å¼€å§‹]) --> A[00_select_wechat<br/>é€‰æ‹©å…¬ä¼—å· âœ…]
    A --> B[01_research<br/>è°ƒç ” âœ…]

    %% ç¬¬ä¸€å±‚å¹¶è¡Œï¼šResearch å
    B --> C[02_rag<br/>RAGæ£€ç´¢ ğŸ”§]
    B --> D[03_titles<br/>ç”Ÿæˆæ ‡é¢˜ âœ…]
    C --> E[04_select_title<br/>é€‰æ‹©æ ‡é¢˜ âœ…]
    D --> E

    E --> F[05_draft<br/>ç”Ÿæˆåˆç¨¿ â¸ï¸]
    F --> G[06_polish<br/>æ¶¦è‰² â¸ï¸]
    G --> H[07_rewrite<br/>æ™ºæ€§å™äº‹é‡å†™ â¸ï¸]

    %% ç¬¬äºŒå±‚å¹¶è¡Œï¼šRewrite å
    H --> I[08_confirm<br/>ç¡®è®¤å›¾ç‰‡é…ç½® â¸ï¸]
    H --> J[09_humanize<br/>å»æœºæ¢°åŒ–+æ´»äººæ„Ÿ â¸ï¸]

    I --> K[10_prompts<br/>ç”Ÿæˆå›¾ç‰‡æç¤ºè¯ â¸ï¸]
    I --> J
    K --> L[11_images<br/>ç”Ÿæˆå›¾ç‰‡ â¸ï¸]
    L --> M[12_upload<br/>ä¸Šä¼ åˆ°CDN â¸ï¸]

    J --> N[13_html<br/>Markdownè½¬HTML â¸ï¸]
    M --> N

    N --> O[14_draftbox<br/>å‘å¸ƒåˆ°è‰ç¨¿ç®± â¸ï¸]
    O --> END([ç»“æŸ])

    style B fill:#d4edda
    style C fill:#fff3cd
    style D fill:#d4edda
    style E fill:#d4edda
    style A fill:#d4edda
    style I fill:#f8f9fa
    style J fill:#f8f9fa
    style K fill:#f8f9fa
    style N fill:#f8f9fa
```

**éªŒè¯çŠ¶æ€å›¾ä¾‹**:
- âœ… å·²éªŒè¯é€šè¿‡
- ğŸ”§ ä¿®å¤ä¸­
- â¸ï¸ å¾…éªŒè¯

## éªŒè¯è¿›åº¦è¡¨

| èŠ‚ç‚¹ | èŠ‚ç‚¹ä½œç”¨ | ç±»å‹ | çŠ¶æ€ |
|------|----------|------|------|
| 00_select_wechat | é€‰æ‹©å…¬ä¼—å·è´¦å· | äº¤äº’ | âœ… éªŒè¯é€šè¿‡ |
| 01_research | æœç´¢ + Brief ç”Ÿæˆ | LLM | âœ… éªŒè¯é€šè¿‡ |
| 02_rag | RAG å‘é‡æ£€ç´¢ | LLM | ğŸ”§ ä¿®å¤ä¸­ |
| 03_titles | ç”Ÿæˆ 8 ä¸ªå€™é€‰æ ‡é¢˜ | LLM | âœ… éªŒè¯é€šè¿‡ |
| 04_select_title | ä»å€™é€‰æ ‡é¢˜ä¸­é€‰æ‹© | äº¤äº’ | âœ… éªŒè¯é€šè¿‡ |
| 05_draft | Research + RAG â†’ åˆç¨¿ | LLM | â¸ï¸ å¾…éªŒè¯ |
| 06_polish | è¯­è¨€æ¶¦è‰²ä¼˜åŒ– | LLM | â¸ï¸ å¾…éªŒè¯ |
| 07_rewrite | æ™ºæ€§å™äº‹é‡å†™ (IPS+HKR) | LLM | â¸ï¸ å¾…éªŒè¯ |
| 08_confirm | ç¡®è®¤å›¾ç‰‡æ•°é‡å’Œé£æ ¼ | äº¤äº’ | â¸ï¸ å¾…éªŒè¯ |
| 09_humanize | å» AI å‘³ + æ´»äººæ„Ÿ | LLM | â¸ï¸ å¾…éªŒè¯ |
| 10_prompts | ç”Ÿæˆå›¾ç‰‡æç¤ºè¯ (5ç§é£æ ¼) | LLM | â¸ï¸ å¾…éªŒè¯ |
| 11_images | Ark API ç”Ÿæˆå›¾ç‰‡ | API | â¸ï¸ å¾…éªŒè¯ |
| 12_upload | ä¸Šä¼ åˆ°å¾®ä¿¡ CDN | API | â¸ï¸ å¾…éªŒè¯ |
| 13_html | Markdown â†’ HTML | ä»£ç  | â¸ï¸ å¾…éªŒè¯ |
| 14_draftbox | å‘å¸ƒåˆ°å¾®ä¿¡è‰ç¨¿ç®± | API | â¸ï¸ å¾…éªŒè¯ |

**å½“å‰è¿›åº¦**: 4/15 èŠ‚ç‚¹å·²éªŒè¯ (27%)

## æ•°æ®æµè¯¦è§£

### é˜¶æ®µ 1: é¡ºåºå‰ç½®æµç¨‹
```
START â†’ 00 â†’ 01
```
- é€‰æ‹©å…¬ä¼—å·
- æ‰§è¡Œè°ƒç ”

### é˜¶æ®µ 2: ç¬¬ä¸€å±‚å¹¶è¡Œ (Research å)
```
        â”Œâ”€â†’ 02_rag â”€â”€â”€â”€â”€â”
01 â”€â”€â”€â”€â”€â”¤               â”œâ”€â†’ 04_select_title
        â””â”€â†’ 03_titles â”€â”€â”˜
```

**å…³é”®è®¾è®¡**:
1. `02_rag` å’Œ `03_titles` åŒæ—¶ä» `01_research` å¼€å§‹
2. ä¸¤è€…éƒ½å®Œæˆåï¼Œ`04_select_title` æ‰èƒ½æ‰§è¡Œ
3. **æ—¶é—´èŠ‚çœ**: max(T02, T03) vs T02 + T03

### é˜¶æ®µ 3: é¡ºåºä¸­é—´æµç¨‹
```
04 â†’ 05 â†’ 06 â†’ 07
```
- é€‰æ‹©æ ‡é¢˜ â†’ ç”Ÿæˆåˆç¨¿ â†’ æ¶¦è‰² â†’ æ™ºæ€§å™äº‹é‡å†™

### é˜¶æ®µ 4: ç¬¬äºŒå±‚å¹¶è¡Œ (Rewrite å)
```
              â”Œâ”€â†’ 08_confirm â”€â”¬â”€â†’ 10_prompts â†’ 11 â†’ 12
07_rewrite â”€â”€â”€â”¤               â”‚
              â””â”€â†’ 09_humanize â†â”˜
```

**å…³é”®è®¾è®¡**:
1. `08_confirm` å’Œ `09_humanize` åŒæ—¶ä» `07_rewrite` å¼€å§‹
2. `09_humanize` ç­‰å¾… `08_confirm` å®Œæˆï¼ˆè·å– imageCountï¼‰
3. `10_prompts` åœ¨ `08_confirm` å®Œæˆåæ‰§è¡Œ
4. `10_prompts` ä½¿ç”¨ `draft` ä½œä¸ºè¾“å…¥ï¼ˆä¸æ˜¯ `humanized`ï¼‰

### é˜¶æ®µ 5: æ±‡èšç‚¹
```
    â”Œâ”€ 09_humanize â”€â”
â”€â”€â”€â”¤                â”œâ”€â†’ 13_html â†’ 14 â†’ END
    â””â”€ 12_upload â”€â”€â”€â”˜
```

**æ±‡èšæ¡ä»¶**:
- `09_humanize` å’Œ `12_upload` éƒ½å®Œæˆå
- `13_html` æ‰å¼€å§‹æ‰§è¡Œ
- å°†å›¾ç‰‡å ä½ç¬¦æ›¿æ¢ä¸º CDN URL

## æ€§èƒ½ä¼˜åŒ–åˆ†æ

### åŸä¸²è¡Œæµç¨‹
```
01 â†’ 02 â†’ 03 â†’ 04 â†’ 05 â†’ 06 â†’ 07 â†’ 08 â†’ 09 â†’ 10 â†’ 11 â†’ 12 â†’ 13
```

### æ–°å¹¶è¡Œæµç¨‹ï¼ˆåŒé‡ä¼˜åŒ–ï¼‰
```
        â”Œâ”€ 02 â”€â”€â”€â”€â”€â”
01 â”€â”€â”€â”€â”€â”¤          â”œâ”€â†’ 04 â†’ 05 â†’ 06 â†’ 07 â”€â”¬â”€â†’ 08 â”€â”¬â”€â†’ 10 â†’ 11 â†’ 12 â”€â”¬â”€â†’ 13
        â””â”€ 03 â”€â”€â”€â”€â”€â”˜                    â””â”€â†’ 09 â†â”˜                  â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¬¬ä¸€å±‚æ—¶é—´èŠ‚çœ** (Research å):
- åŸ: T02 + T03
- æ–°: max(T02, T03)
- èŠ‚çœ: min(T02, T03)

**ç¬¬äºŒå±‚æ—¶é—´èŠ‚çœ** (Rewrite å):
- åŸ: T08 + T09 + T10 + T11 + T12
- æ–°: max(T08 + T10 + T11 + T12, T09)
- èŠ‚çœ: T09 (humanize èŠ‚ç‚¹æ‰§è¡Œæ—¶é—´)

**æ€»æ—¶é—´èŠ‚çœ**:
```
åŸ: T01 + T02 + T03 + ... + T13
æ–°: T01 + max(T02, T03) + ... + max(T08+T10+T11+T12, T09) + T13
```

å‡è®¾ T02=30s, T03=20s, T09=15s:
- ç¬¬ä¸€å±‚èŠ‚çœ: 20s
- ç¬¬äºŒå±‚èŠ‚çœ: 15s
- **æ€»èŠ‚çœ: 35s**

## çŠ¶æ€ä¾èµ–å…³ç³»

| èŠ‚ç‚¹ | è¯»å–çŠ¶æ€ | å†™å…¥çŠ¶æ€ |
|------|---------|---------|
| 08_confirm | - | `decisions.images.count` |
| 09_humanize | `decisions.images.count` | `humanized` + å ä½ç¬¦ |
| 10_prompts | `draft` + `decisions.images` | `imagePrompts` |
| 11_images | `imagePrompts` | `imagePaths` |
| 12_upload | `imagePaths` | `uploadedImageUrls` |
| 13_html | `humanized` + `uploadedImageUrls` | `html` |

## è¾¹ç•Œæƒ…å†µå¤„ç†

### å¦‚æœ confirm è¢«è·³è¿‡
- `09_humanize` ä½¿ç”¨é»˜è®¤å€¼ `imageCount = 0`
- `10_prompts` ä½¿ç”¨é»˜è®¤å€¼ `count = 4, style = infographic`

### å¦‚æœå›¾ç‰‡ç”Ÿæˆå¤±è´¥
- `12_upload` è¿”å›ç©ºæ•°ç»„
- `13_html` è·³è¿‡å›¾ç‰‡æ›¿æ¢ï¼Œä¿ç•™å ä½ç¬¦

### å¦‚æœ humanize å¤±è´¥
- é™çº§åˆ° `rewritten` æˆ– `polished`
- `13_html` ç»§ç»­æ‰§è¡Œ
