# Article Agent Workflow Graph

## åŒé‡å¹¶è¡Œä¼˜åŒ–ç‰ˆæµç¨‹å›¾

```mermaid
graph TD
    START([å¼€å§‹]) --> A[00_select_wechat<br/>é€‰æ‹©å…¬ä¼—å· âœ…]
    A --> B[01_research<br/>è°ƒç ” âœ…]

    %% ç¬¬ä¸€å±‚å¹¶è¡Œï¼šResearch å
    B --> C[02_rag<br/>RAGæ£€ç´¢ âœ…]
    B --> D[03_titles<br/>ç”Ÿæˆæ ‡é¢˜ âœ…]
    C --> E[04_select_title<br/>é€‰æ‹©æ ‡é¢˜ âœ…]
    D --> E

    E --> F[05_draft<br/>ç”Ÿæˆåˆç¨¿ âœ…]
    F --> G[06_rewrite<br/>æ™ºæ€§å™äº‹é‡å†™ âœ…]

    %% ç¬¬äºŒå±‚å¹¶è¡Œï¼šRewrite å
    G --> H[07_confirm<br/>ç¡®è®¤å›¾ç‰‡é…ç½® âœ…]
    G --> I[08_humanize<br/>å»æœºæ¢°åŒ–+æ´»äººæ„Ÿ âœ…]

    H --> J[09_prompts<br/>ç”Ÿæˆå›¾ç‰‡æç¤ºè¯ âœ…]
    J --> K[10_images<br/>ç”Ÿæˆå›¾ç‰‡ âœ…]
    K --> L[11_upload<br/>ä¸Šä¼ åˆ°CDN âœ…]

    I --> M[12_html<br/>Markdownè½¬HTML ğŸ”§]
    L --> M

    M --> N[13_draftbox<br/>å‘å¸ƒåˆ°è‰ç¨¿ç®± â¸ï¸]
    N --> END([ç»“æŸ])

    style A fill:#d4edda
    style B fill:#d4edda
    style C fill:#d4edda
    style D fill:#d4edda
    style E fill:#d4edda
    style F fill:#d4edda
    style G fill:#d4edda
    style H fill:#d4edda
    style I fill:#d4edda
    style J fill:#d4edda
    style K fill:#d4edda
    style L fill:#d4edda
    style M fill:#fff3cd
    style N fill:#f8f9fa
```

**éªŒè¯çŠ¶æ€å›¾ä¾‹**:
- âœ… å·²éªŒè¯é€šè¿‡
- ğŸ”§ ä¿®å¤ä¸­
- â¸ï¸ å¾…éªŒè¯

## éªŒè¯è¿›åº¦è¡¨

| èŠ‚ç‚¹ | èŠ‚ç‚¹ä½œç”¨ | ç±»å‹ | çŠ¶æ€ |
|------|----------|------|------|
| 00_select_wechat | é€‰æ‹©å…¬ä¼—å·è´¦å· | äº¤äº’ | âœ… éªŒè¯é€šè¿‡ |
| 01_research | æœç´¢ + Brief ç”Ÿæˆ | LLM | âœ… éªŒè¯é€šè¿‡ |
| 02_rag | RAG å‘é‡æ£€ç´¢ | LLM | âœ… éªŒè¯é€šè¿‡ |
| 03_titles | ç”Ÿæˆ 8 ä¸ªå€™é€‰æ ‡é¢˜ | LLM | âœ… éªŒè¯é€šè¿‡ |
| 04_select_title | ä»å€™é€‰æ ‡é¢˜ä¸­é€‰æ‹© | äº¤äº’ | âœ… éªŒè¯é€šè¿‡ |
| 05_draft | Research + RAG â†’ åˆç¨¿ | LLM | âœ… éªŒè¯é€šè¿‡ |
| 06_rewrite | æ™ºæ€§å™äº‹é‡å†™ (IPS+HKR) | LLM | âœ… éªŒè¯é€šè¿‡ |
| 07_confirm | ç¡®è®¤å›¾ç‰‡æ•°é‡å’Œé£æ ¼ | äº¤äº’ | âœ… éªŒè¯é€šè¿‡ |
| 08_humanize | å» AI å‘³ + æ´»äººæ„Ÿ | LLM | âœ… éªŒè¯é€šè¿‡ |
| 09_prompts | ç”Ÿæˆå›¾ç‰‡æç¤ºè¯ (5ç§é£æ ¼) | LLM | âœ… éªŒè¯é€šè¿‡ |
| 10_images | Ark API ç”Ÿæˆå›¾ç‰‡ | API | âœ… éªŒè¯é€šè¿‡ |
| 11_upload | ä¸Šä¼ åˆ°å¾®ä¿¡ CDN | API | âœ… éªŒè¯é€šè¿‡ |
| 12_html | Markdown â†’ HTML | ä»£ç  | ğŸ”§ ä¿®å¤ä¸­ |
| 13_draftbox | å‘å¸ƒåˆ°å¾®ä¿¡è‰ç¨¿ç®± | API | â¸ï¸ å¾…éªŒè¯ |

**å½“å‰è¿›åº¦**: 12/14 èŠ‚ç‚¹å·²éªŒè¯ (86%)

## æ•°æ®æµè¯¦è§£

### é˜¶æ®µ 1: é¡ºåºå‰ç½®æµç¨‹
```
START â†’ 00 â†’ 01
```
- é€‰æ‹©å…¬ä¼—å·
- æ‰§è¡Œè°ƒç ”

### é˜¶æ®µ 2: ç¬¬ä¸€å±‚å¹¶è¡Œ (Research å)
```
        â”Œâ”€â†’ 02_rag â”€â”€â”€â”€â”€â”
01 â”€â”€â”€â”€â”€â”¤               â”œâ”€â†’ 04_select_title
        â””â”€â†’ 03_titles â”€â”€â”˜
```

**å…³é”®è®¾è®¡**:
1. `02_rag` å’Œ `03_titles` åŒæ—¶ä» `01_research` å¼€å§‹
2. ä¸¤è€…éƒ½å®Œæˆåï¼Œ`04_select_title` æ‰èƒ½æ‰§è¡Œ
3. **æ—¶é—´èŠ‚çœ**: max(T02, T03) vs T02 + T03

### é˜¶æ®µ 3: é¡ºåºä¸­é—´æµç¨‹
```
04 â†’ 05 â†’ 06
```
- é€‰æ‹©æ ‡é¢˜ â†’ ç”Ÿæˆåˆç¨¿ â†’ æ™ºæ€§å™äº‹é‡å†™

### é˜¶æ®µ 4: ç¬¬äºŒå±‚å¹¶è¡Œ (Rewrite å)
```
              â”Œâ”€â†’ 07_confirm â”€â†’ 09_prompts â†’ 10_images â†’ 11_upload
06_rewrite â”€â”€â”€â”¤
              â””â”€â†’ 08_humanize
```

**å…³é”®è®¾è®¡**:
1. `07_confirm` å’Œ `08_humanize` åŒæ—¶ä» `06_rewrite` å¼€å§‹
2. `09_prompts` åœ¨ `07_confirm` å®Œæˆåæ‰§è¡Œ
3. `09_prompts` ä½¿ç”¨ `draft` ä½œä¸ºè¾“å…¥ï¼ˆä¸æ˜¯ `humanized`ï¼‰

### é˜¶æ®µ 5: æ±‡èšç‚¹
```
    â”Œâ”€ 08_humanize â”€â”
â”€â”€â”€â”¤                â”œâ”€â†’ 12_html â†’ 13_draftbox â†’ END
    â””â”€ 11_upload â”€â”€â”€â”˜
```

**æ±‡èšæ¡ä»¶**:
- `08_humanize` å’Œ `11_upload` éƒ½å®Œæˆå
- `12_html` æ‰å¼€å§‹æ‰§è¡Œ
- å°†å›¾ç‰‡å ä½ç¬¦æ›¿æ¢ä¸º CDN URL

## æ€§èƒ½ä¼˜åŒ–åˆ†æ

### åŸä¸²è¡Œæµç¨‹
```
01 â†’ 02 â†’ 03 â†’ 04 â†’ 05 â†’ 06 â†’ 07 â†’ 08 â†’ 09 â†’ 10 â†’ 11 â†’ 12 â†’ 13
```

### æ–°å¹¶è¡Œæµç¨‹ï¼ˆåŒé‡ä¼˜åŒ–ï¼‰
```
        â”Œâ”€ 02 â”€â”€â”€â”€â”€â”
01 â”€â”€â”€â”€â”€â”¤          â”œâ”€â†’ 04 â†’ 05 â†’ 06 â”€â”¬â”€â†’ 07 â”€â†’ 09 â†’ 10 â†’ 11 â”€â”¬â”€â†’ 12 â”€â†’ 13
        â””â”€ 03 â”€â”€â”€â”€â”€â”˜                 â””â”€â†’ 08 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¬¬ä¸€å±‚æ—¶é—´èŠ‚çœ** (Research å):
- åŸ: T02 + T03
- æ–°: max(T02, T03)
- èŠ‚çœ: min(T02, T03)

**ç¬¬äºŒå±‚æ—¶é—´èŠ‚çœ** (Rewrite å):
- åŸ: T07 + T08 + T09 + T10 + T11 + T12
- æ–°: T07 + max(T08, T09 + T10 + T11) + T12
- èŠ‚çœ: min(T08, T09 + T10 + T11)

**æ€»æ—¶é—´èŠ‚çœ**:
```
åŸ: T01 + T02 + T03 + ... + T13
æ–°: T01 + max(T02, T03) + ... + T07 + max(T08, T09+T10+T11) + T12 + T13
```

å‡è®¾ T02=30s, T03=20s, T08=15s, T09+T10+T11=30s:
- ç¬¬ä¸€å±‚èŠ‚çœ: 20s
- ç¬¬äºŒå±‚èŠ‚çœ: 15s
- **æ€»èŠ‚çœ: 35s**

## çŠ¶æ€ä¾èµ–å…³ç³»

| èŠ‚ç‚¹ | è¯»å–çŠ¶æ€ | å†™å…¥çŠ¶æ€ |
|------|---------|---------|
| 07_confirm | - | `decisions.images.count` |
| 08_humanize | `decisions.images.count` | `humanized` + å ä½ç¬¦ |
| 09_prompts | `draft` + `decisions.images` | `imagePrompts` |
| 10_images | `imagePrompts` | `imagePaths` |
| 11_upload | `imagePaths` | `uploadedImageUrls` |
| 12_html | `humanized` + `uploadedImageUrls` | `html` |

## è¾¹ç•Œæƒ…å†µå¤„ç†

### å¦‚æœ confirm è¢«è·³è¿‡
- `08_humanize` ä½¿ç”¨é»˜è®¤å€¼ `imageCount = 0`
- `09_prompts` ä½¿ç”¨é»˜è®¤å€¼ `count = 4, style = infographic`

### å¦‚æœå›¾ç‰‡ç”Ÿæˆå¤±è´¥
- `11_upload` è¿”å›ç©ºæ•°ç»„
- `12_html` ä¼šæŠ¥é”™å¹¶ä¸­æ­¢ï¼Œéœ€è¦é‡è¯•ä¸Šä¼ æˆ–å°†å›¾ç‰‡æ•°è®¾ä¸º 0

### å¦‚æœ humanize å¤±è´¥
- é™çº§åˆ° `rewritten`
- `12_html` ç»§ç»­æ‰§è¡Œ
