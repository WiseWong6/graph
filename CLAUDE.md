# Write Agent - è¿›åº¦è·Ÿè¸ª

> åŸºäº LangGraph.js çš„æ™ºèƒ½å†…å®¹ç”Ÿæˆç³»ç»Ÿï¼Œé‡‡ç”¨ Research-First å·¥ä½œæµ

---

## é¡¹ç›®æ¦‚è¿°

**æ ¸å¿ƒç‰¹æ€§**:
- å¹¶è¡Œæœç´¢ï¼ˆFirecrawl + WebResearchï¼‰
- å†…å®¹åˆ›ä½œè§†è§’çš„ Brief ç”Ÿæˆ
- RAG å¢å¼ºå†™ä½œï¼ˆé‡‘å¥åº“ + æ–‡ç« åº“ï¼‰
- æ™ºæ€§å™äº‹é‡å†™ (Rewrite)
- å»æœºæ¢°åŒ–å¤„ç† (Humanize)
- å®Œæ•´å›¾ç‰‡ç”Ÿæˆæµç¨‹ï¼ˆArk APIï¼‰
- å¾®ä¿¡è‰ç¨¿ç®±å‘å¸ƒ

**æŠ€æœ¯æ ˆ**:
- **æ¡†æ¶**: LangGraph.js
- **è¯­è¨€**: TypeScript
- **LLM**: DeepSeek (Research) / Anthropic (Draft/Rewrite)
- **æœç´¢**: Firecrawl + Playwright
- **RAG**: LlamaIndex.js + SimpleVectorStore
- **ç”Ÿå›¾**: ç«å±± Ark API (Doubao Seedream)

---

## èŠ‚ç‚¹å®ŒæˆçŠ¶æ€

```
00_select_wechat âœ… | 01_research âœ… | 02_rag âœ…
03_titles âœ… | 04_select_title âœ… | 05_draft âœ…
06_rewrite âœ… | 07_confirm âœ… | 08_humanize âœ…
09_prompts âœ… | 10_images âœ… | 11_upload âœ…
12_html ğŸ”§ | 13_draftbox â¸ï¸
```

**æµç¨‹è¯´æ˜**:
- **12/14 èŠ‚ç‚¹å·²éªŒè¯**ï¼ˆ12_html ä¿®å¤å¾…éªŒï¼Œdraftbox å¾…å›å½’ï¼‰ğŸ”§
- åŒé‡å¹¶è¡Œï¼šRAG+Titles å¹¶è¡Œï¼ŒPrompts+Humanize å¹¶è¡Œ
- æ±‡èšç‚¹æ”¹ä¸º join è¾¹ï¼Œé¿å… 12_html æŠ¢è·‘å¯¼è‡´ uploadedImageUrls ç¼ºå¤±

---

## æ ¸å¿ƒåŠŸèƒ½

### Research èŠ‚ç‚¹ (01)
- å¹¶è¡Œæœç´¢ç®¡ç†å™¨ï¼ˆå¤šæº + é™çº§ï¼‰
- LLM åˆ†æï¼šå…³é”®æ´å¯Ÿã€æ¦‚å¿µæ¡†æ¶ã€æ•°æ®æ”¯æ’‘ã€å·®å¼‚åŒ–è§’åº¦
- Brief ç”Ÿæˆï¼šå†…å®¹åˆ›ä½œè§†è§’æ¨¡æ¿ + ç½®ä¿¡åº¦æ ‡ç­¾

### RAG èŠ‚ç‚¹ (02)
- è§£æè„šæœ¬ï¼šExcel â†’ JSONLï¼ˆ6,975 ç¯‡æ–‡ç« ï¼‰
- ç´¢å¼•æ„å»ºï¼šIndexManager + å‘é‡ç´¢å¼•
- æ£€ç´¢åŠŸèƒ½ï¼šé‡‘å¥åº“ï¼ˆ37,420 æ¡ï¼‰+ æ–‡ç« åº“ï¼ˆ6,975 ç¯‡ï¼‰+ æ··åˆæ£€ç´¢

### Titles èŠ‚ç‚¹ (03)
- åŸºäº Brief æ¨èè§’åº¦ç”Ÿæˆæ ‡é¢˜
- RAG æ ‡é¢˜åº“æ£€ç´¢æä¾›å‚è€ƒ
- ç”Ÿæˆ 5-10 ä¸ªå€™é€‰æ ‡é¢˜

### Gate C (04) - select_title
- ä»å€™é€‰æ ‡é¢˜ä¸­é€‰æ‹©
- è‡ªå®šä¹‰æ ‡é¢˜è¾“å…¥ï¼ˆå«å¯é€‰å¤‡æ³¨ï¼‰
- é‡æ–°ç”Ÿæˆæ ‡é¢˜é€‰é¡¹

### Draft èŠ‚ç‚¹ (05)
- Brief è§£æï¼šæ ¸å¿ƒæ´å¯Ÿã€æ¦‚å¿µæ¡†æ¶ã€æ¨èè§’åº¦ã€æ•°æ®ç‚¹
- RAG è§£æï¼šé‡‘å¥ + æ–‡ç« ç‰‡æ®µ + å‚è€ƒæ ‡é¢˜
- å¼ºåˆ¶è¦æ±‚ç”¨æˆ·é€‰æ‹©æ ‡é¢˜

### Rewrite èŠ‚ç‚¹ (06)
- æ™ºæ€§å››æ­¥æ³•ï¼šæ‰“ç ´è®¤çŸ¥ â†’ é€šä¿—è§£æ„ â†’ è·¨ç•Œå‡ç»´ â†’ æ€ç»´ç•™ç™½
- IPS åŸåˆ™ï¼šåç›´è§‰æ´å¯Ÿ + è·¨å­¦ç§‘å¼•ç”¨ + ç®€å•æ˜“æ‡‚
- HKR è‡ªæ£€ï¼šæ‚¬å¿µ + æ–°çŸ¥ + å…±é¸£

### Humanize èŠ‚ç‚¹ (08)
- æ ¼å¼æ¸…æ´—ï¼šå»ç©ºæ ¼ã€æ ‡ç‚¹è§„èŒƒã€å»å¼•å·
- é£æ ¼é‡å†™ï¼šå» AI å‘³ã€æ®µè½èåˆã€å£è¯­åŒ–
- ä¿ç•™ Markdown ç»“æ„ï¼ˆä»£ç /é“¾æ¥/å›¾ç‰‡ï¼‰

### Images æµç¨‹ (09-11)
- **Prompts (09)**: 5 ç§é£æ ¼ï¼ˆinfographic/healing/pixar/sokamono/handdrawnï¼‰
- **Images (10)**: Ark API ç”Ÿå›¾ + å¹¶è¡Œç”Ÿæˆ + æ°´å°å…³é—­
- **Upload (11)**: å¾®ä¿¡ CDN å¹¶è¡Œä¸Šä¼ ï¼ˆå›¾æ–‡æ¶ˆæ¯å›¾ç‰‡ï¼‰

### HTML èŠ‚ç‚¹ (12)
- markdown-it è§£æ Markdown
- å›¾ç‰‡å ä½ç¬¦æ›¿æ¢ä¸º CDN URL
- å¾®ä¿¡ç¼–è¾‘å™¨æ ·å¼
- ä¿å­˜ HTML + Markdown

### Draftbox èŠ‚ç‚¹ (13)
- ä¸Šä¼ æ°¸ä¹…ç¼©ç•¥å›¾ç´ æï¼ˆthumb_media_id å¿…å¡«ï¼‰
- ä½¿ç”¨ stable access_token API
- å‘å¸ƒåˆ°å¾®ä¿¡è‰ç¨¿ç®±
- æ‘˜è¦é™åˆ¶ 54 ä¸ªæ±‰å­—

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

### 1. ç«¯åˆ°ç«¯éªŒè¯
- è¿è¡Œå®Œæ•´æµç¨‹ï¼š`npm run step`
- ä»ä¸»é¢˜é€‰æ‹©åˆ°è‰ç¨¿ç®±å‘å¸ƒ
- éªŒè¯æ‰€æœ‰èŠ‚ç‚¹ä¸²è”æ­£å¸¸
- é‡ç‚¹å…³æ³¨ 12_html æ˜¯å¦åœ¨ 11_upload å®Œæˆåå†è§¦å‘
  - è‹¥è¦ç»­è·‘å¤±è´¥ä¼šè¯ï¼š`npm run step -- --resume`

### 2. ç¡®ä¿å¹¶è¡Œæ“ä½œ
- éªŒè¯ RAG + Titles å¹¶è¡Œæ‰§è¡Œ
- éªŒè¯ Prompts + Humanize å¹¶è¡Œæ‰§è¡Œ
- æ£€æŸ¥å¹¶è¡Œæœç´¢åŠŸèƒ½
- ç¡®è®¤å¹¶è¡Œå›¾ç‰‡ä¸Šä¼ 

### 3. å¤š LLM æ”¯æŒ
- Research èŠ‚ç‚¹ï¼šDeepSeek
- Draft/Rewrite èŠ‚ç‚¹ï¼šAnthropic
- Titles èŠ‚ç‚¹ï¼šå¯é€‰é…ç½®
- Humanize èŠ‚ç‚¹ï¼šå¯é€‰é…ç½®

---

## å˜æ›´æ—¥å¿—

### 2026-01-19
- **ä¿®å¤å¹¶è¡Œæ±‡èšæ—¶åº**: 12_html ä½¿ç”¨ join è¾¹ç­‰å¾… 11_upload + 08_humanize å®Œæˆ
- **æ ‡é¢˜é€‰æ‹© join**: gate_c_select_title ä½¿ç”¨ join è¾¹ç­‰å¾… 02_rag + 03_titles
- **HTML èŠ‚ç‚¹éªŒæ”¶é€šè¿‡**: markdown-it è§£æ + å›¾ç‰‡æ›¿æ¢ï¼ˆéœ€å›å½’ join ä¿®å¤ï¼‰
- **Draftbox èŠ‚ç‚¹éªŒæ”¶é€šè¿‡**: æ°¸ä¹…ç¼©ç•¥å›¾ç´ æ + stable token
- **å®Œæ•´å‘å¸ƒæµç¨‹æµ‹è¯•**: `scripts/test-publish-flow.ts`
- **å¾®ä¿¡ API ä¿®å¤**:
  - ä½¿ç”¨ `/cgi-bin/stable_token` æ›¿ä»£æ—§ API
  - thumb_media_id å¿…å¡«ï¼ˆä¸Šä¼ æ°¸ä¹…ç´ æï¼‰
  - æ‘˜è¦é•¿åº¦é™åˆ¶ 54 ä¸ªæ±‰å­—
- **æ‰€æœ‰ 14 ä¸ªèŠ‚ç‚¹éªŒæ”¶é€šè¿‡** âœ…

### 2026-01-18
- **ResumeManager**: æ¢å¤ç•Œé¢æ˜¾ç¤ºèŠ‚ç‚¹åç§°
- **Upload èŠ‚ç‚¹**: state.wechat é…ç½®ä¿®å¤ + FormData æ–‡ä»¶åä¿®å¤
- **åˆ é™¤ Polish èŠ‚ç‚¹**: 15 â†’ 14 èŠ‚ç‚¹
- **Gate C å¢å¼º**: è‡ªå®šä¹‰æ ‡é¢˜ + é‡æ–°ç”Ÿæˆé€‰é¡¹
- **Draft å¼ºåŒ–**: å¼ºåˆ¶è¦æ±‚ç”¨æˆ·é€‰æ‹©æ ‡é¢˜
- **åŒé‡å¹¶è¡Œä¼˜åŒ–**: RAG+Titles å¹¶è¡Œ + æ–‡æœ¬/å›¾ç‰‡å¹¶è¡Œ
- **IndexManager**: å¹‚ç­‰æ€§ä¿æŠ¤ + å¹¶å‘åŠ è½½é”
- **step-cli**: åªåœ¨äº¤äº’å¼èŠ‚ç‚¹åæš‚åœ
- **æµå¼è¾“å‡º**: DeepSeek æ€è€ƒè¿‡ç¨‹é€å­—æ˜¾ç¤º
- **æœç´¢è¶…æ—¶**: 8ç§’ â†’ 30ç§’ + åˆ é™¤ DuckDuckGo
- **æ ‡é¢˜è§£æ**: Prompt å®¹é”™ + max_tokensâ†’2048
- **Reasoner æ³„éœ²ä¿®å¤**: åˆ‡æ¢ deepseek-chat æ¨¡å‹
- **LanceDB ç±»å‹ä¿®å¤**: å‘é‡å­˜å‚¨ç±»å‹é”™è¯¯

### 2026-01-17
- **Research èŠ‚ç‚¹**: æœç´¢ + Brief ç”Ÿæˆ
- **RAG èŠ‚ç‚¹**: ç´¢å¼•æ„å»º + å‘é‡æ£€ç´¢éªŒè¯é€šè¿‡
- **Draft èŠ‚ç‚¹**: Brief + RAG è§£æå¢å¼º
- **Rewrite èŠ‚ç‚¹**: æ™ºæ€§å™äº‹å®ç°
- **Humanize èŠ‚ç‚¹**: å»æœºæ¢°åŒ–å®ç°

---

## ä½¿ç”¨æ–¹å¼

```bash
npm run step              # å•æ­¥äº¤äº’å¼
npm run step -- --resume  # æ¢å¤ä¼šè¯
npm run test-full         # å®Œæ•´æµç¨‹éªŒè¯
npm run research          # äº¤äº’å¼è°ƒç ”
npm run test-interactive  # å›¾ç‰‡ç”Ÿæˆæµ‹è¯•
npm run test-publish-flow # å‘å¸ƒæµç¨‹æµ‹è¯•
```

### RAG ç›¸å…³
```bash
npm run parse-articles    # è§£ææ–‡ç« åº“ Excel
npm run build-indices     # æ„å»ºå‘é‡ç´¢å¼•
```

---

## é¡¹ç›®ç»“æ„

```
write-agent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ agents/article/
â”‚   â”‚   â””â”€â”€ nodes/
â”‚   â”‚       â”œâ”€â”€ 00_select_wechat.node.ts  âœ…
â”‚   â”‚       â”œâ”€â”€ 01_research.node.ts       âœ…
â”‚   â”‚       â”œâ”€â”€ 02_rag.node.ts            âœ…
â”‚   â”‚       â”œâ”€â”€ 03_titles.node.ts         âœ…
â”‚   â”‚       â”œâ”€â”€ 04_select_title.node.ts   âœ… (è‡ªå®šä¹‰ + é‡ç”Ÿæˆ)
â”‚   â”‚       â”œâ”€â”€ 05_draft.node.ts          âœ… (å¼ºåˆ¶æ ‡é¢˜)
â”‚   â”‚       â”œâ”€â”€ 06_rewrite.node.ts        âœ…
â”‚   â”‚       â”œâ”€â”€ 07_confirm.node.ts        âœ…
â”‚   â”‚       â”œâ”€â”€ 08_humanize.node.ts       âœ…
â”‚   â”‚       â”œâ”€â”€ 09_prompts.node.ts        âœ…
â”‚   â”‚       â”œâ”€â”€ 10_images.node.ts         âœ…
â”‚   â”‚       â”œâ”€â”€ 11_upload.node.ts         âœ… (stable token)
â”‚   â”‚       â”œâ”€â”€ 12_html.node.ts           âœ…
â”‚   â”‚       â””â”€â”€ 13_draftbox.node.ts       âœ… (æ°¸ä¹…ç´ æ)
â”‚   â”œâ”€â”€ rag/           # RAG ç´¢å¼•ç®¡ç†
â”‚   â”œâ”€â”€ adapters/      # LLM/æœç´¢é€‚é…å™¨
â”‚   â”œâ”€â”€ cli/           # ResumeManager äº¤äº’
â”‚   â”œâ”€â”€ config/        # èŠ‚ç‚¹é…ç½®
â”‚   â””â”€â”€ utils/         # å·¥å…·å‡½æ•°
â”œâ”€â”€ scripts/           # æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ test-publish-flow.ts  # å‘å¸ƒæµç¨‹æµ‹è¯•
â”œâ”€â”€ data/              # RAG æ•°æ®
â””â”€â”€ docs/
    â””â”€â”€ ARCHITECTURE.md
```
